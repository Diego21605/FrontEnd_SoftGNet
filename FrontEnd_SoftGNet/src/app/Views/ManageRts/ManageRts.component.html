<app-sideBar></app-sideBar>

<div class="d-flex justify-content-center overlay" *ngIf="load">
    <div style="margin: auto;">
        <p-progressSpinner></p-progressSpinner>
    </div>
</div>

<div class="title m-4">
    <h1>Información de Rutas</h1>
</div>

<p-card>
    <p-toolbar styleClass="mb-4 gap-2">
        <ng-template pTemplate="left">
            <button pButton pRipple label="Crear Ruta" icon="pi pi-plus" class="p-button-success mx-2" (click)="showModalRoutes()"></button>
            <button pButton pRipple label="Eliminar Todo" icon="pi pi-trash" class="p-button-danger mx-2" (click)="deleteAllRoutes()"></button>
        </ng-template>
    </p-toolbar>

    <p-table 
    #tableRoutes 
    [value]="routesVehicles" 
    [paginator]="true"
    [rowHover]="true" 
    [rows]="10" 
    [rowsPerPageOptions]="[10,20,30,50,70,100]"
    dataKey="id" 
    currentPageReportTemplate="Mostrando del {first} al {last} de {totalRecords} registros"
    [showCurrentPageReport]="true" 
    [scrollable]="true" 
    scrollHeight="50rem"
    *ngIf="!load">
        <ng-template pTemplate="header">
            <tr>
                <th rowspan="2">#</th>
                <th><input pInputText type="text" style="width: 100%;" (input)="filterData($event, 'id')"></th>
                <th><input pInputText type="text" style="width: 100%;" (input)="filterData($event, 'description')"></th>
                <th><input pInputText type="text" style="width: 100%;" (input)="filterData($event, 'driver')"></th>
                <th><input pInputText type="text" style="width: 100%;" (input)="filterData($event, 'vehicle')"></th>
                <th><input pInputText type="text" style="width: 100%;" (input)="filterData($event, 'active')"></th>
                <th></th>
            </tr>
            <tr>
                <th>Id</th>
                <th>Descripción</th>
                <th>Conductor</th>
                <th>Vehiculo</th>
                <th>Estado</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-data let-rowIndex="rowIndex">
            <tr>
                <td>{{rowIndex + 1}}</td>
                <td>{{data.id}}</td>
                <td>{{data.description | uppercase}}</td>
                <td>{{data.driver | uppercase}}</td>
                <td>{{data.vehicle | uppercase}}</td>
                <td class="text-center"><span class="badge" [ngClass]="{'bg-danger1': data.active == false, 'bg-success1': data.active == true}">{{data.active == true ? 'Activo' : 'Inactivo'}}</span></td>
                <td>
                    <button pButton pRipple icon="pi pi-pencil" class="p-button-rounded p-button-success mx-2" (click)="showModalRoutes(data)"></button>
                    <button pButton pRipple icon="pi pi-trash" class="p-button-rounded p-button-warning mx-2" (click)="deleteRoute(data.id)"></button>
                </td>
            </tr>
        </ng-template>
    </p-table>
</p-card>

<p-dialog [(visible)]="modalRoutes" [style]="{ width: '70%', height: '90%' }" header="Detalles" [modal]="true" styleClass="p-fluid">
    <ng-template pTemplate="content">
        <form [formGroup]="formRoute" (ngSubmit)="validateRoute()">
            <div class="row g-4 my-4">
                <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 col-xxl-6">
                    <span class="p-float-label">
                        <input pInputText formControlName="id" id="id"/>
                        <label id="id">Id</label>
                    </span>
                </div>
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-6 col-xl-6 col-xxl-6">
                    <span class="p-float-label">
                        <input pInputText formControlName="description" id="name"/>
                        <label id="name">Descripción</label>
                    </span>
                </div>
                <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 col-xxl-6">
                    <span class="p-float-label">
                        <p-dropdown [options]="drivers" formControlName="driver_Id" optionLabel="first_name" optionValue="id" inputId="float-label"></p-dropdown>
                        <label for="float-label">Conductor</label>
                    </span>
                </div>
                <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 col-xxl-6">
                    <span class="p-float-label">
                        <p-dropdown [options]="vehicles" formControlName="vehicle_Id" optionLabel="description" optionValue="id" inputId="float-label"></p-dropdown>
                        <label for="float-label">Vehiculo</label>
                    </span>
                </div>
                <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 col-xxl-6">
                    <span class="p-float-label">
                        <p-dropdown [options]="states" formControlName="active" optionLabel="Name" optionValue="Id" inputId="float-label"></p-dropdown>
                        <label for="float-label">Estado</label>
                    </span>
                </div>
            </div>

            <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                <button pButton class="p-button-danger" type="submit" label="Enviar Datos" icon="pi pi-send" [disabled]="load"></button>
                <button pButton class="p-button-secondary" type="button" label="Limpiar Campos" icon="pi pi-eraser" [disabled]="load" (click)="this.formRoute.reset()"></button>
            </div>
        </form>
    </ng-template>
</p-dialog>